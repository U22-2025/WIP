# 気象データRedisデータベースのキー構造

このドキュメントでは、気象庁の天気予報データをRedisに格納するために使用される主要なキー構造を解説します。

## グローバル情報

| キー | 形式 | 説明 |
|------|------|------|
| `weather:last_updated` | 文字列 | データの最終更新時刻（ISO形式） |
| `all_areas` | ハッシュ | 全エリアコードとエリア名のマッピング |

## オフィス関連のキー

| キー | 形式 | 説明 |
|------|------|------|
| `office:{office_code}` | ハッシュ | オフィス情報（名前、更新時刻） |
| `office_data:{office_code}` | 文字列 | オフィスの元データ（JSON形式） |

## エリア関連のキー

| キー | 形式 | 説明 |
|------|------|------|
| `area:{area_code}` | ハッシュ | エリア基本情報（名前、親オフィス等） |
| `area:{area_code}:date:{date}` | ハッシュ | 特定日付のエリア予報データ |
| `area:{area_code}:type:{data_type}` | ハッシュ | 特定データ種別の予報値（時刻→値） |
| `area:{area_code}:series:{forecast_type}:{series_idx}` | 文字列 | 時系列データのJSONキャッシュ |
| `area:{area_code}:series_index` | セット | エリアの全時系列データインデックス |
| `area:{area_code}:average:{avg_type}` | ハッシュ | 平均データ（気温・降水量など） |

## 時間関連のキー（逆引き用）

| キー | 形式 | 説明 |
|------|------|------|
| `time:{date}:{forecast_type}:{data_type}` | ハッシュ | 特定時刻の全エリアデータ（エリア→値） |

## データ格納例

### オフィスデータ例

```
office:010000 = {
  "name": "札幌管区気象台",
  "updated_at": "2023-05-21T10:00:00.123456"
}
```

### エリア基本情報例

```
area:011000 = {
  "name": "札幌",
  "parent_office": "010000",
  "parent_name": "札幌管区気象台",
  "publishing_office": "札幌管区気象台",
  "updated_at": "2023-05-21T10:00:00.123456"
}
```

### 日付別エリアデータ例

```
area:011000:date:2023-05-21 = {
  "srf:weather:2023-05-21T00:00:00+09:00": "晴れ",
  "srf:temperature:2023-05-21T00:00:00+09:00": "18",
  "srf:pop:2023-05-21T00:00:00+09:00": "10"
}
```

### データ種別ごとの時系列例

```
area:011000:type:weather = {
  "2023-05-21T00:00:00+09:00": "晴れ",
  "2023-05-22T00:00:00+09:00": "曇り",
  "2023-05-23T00:00:00+09:00": "雨"
}
```

### 時間別の全エリアデータ例（逆引き）

```
time:2023-05-21:srf:weather = {
  "011000": "晴れ",
  "012000": "曇り",
  "013000": "雨"
}
```

### 時系列JSONキャッシュ例

```
area:011000:series:srf:0 = {
  "timeDefines": ["2023-05-21T00:00:00+09:00", "2023-05-22T00:00:00+09:00"],
  "data": {
    "weather": ["晴れ", "曇り"],
    "temperature": ["18", "20"],
    "pop": ["10", "30"]
  }
}
```

### 平均データ例

```
area:011000:average:temp = {
  "min": "15",
  "max": "22",
  "updated_at": "2023-05-21T10:00:00.123456"
}
```
