# weatherプロトコル　仕様書

## 概要
- NTPをベースとしたプロトコル
- 気象庁の公開している気象情報、災害情報をXML形式で取得して、weatherプロトコルに変換して提供する。 ( https://xml.kishou.go.jp/xmlpull.html )
- リクエストに含まれたデータから、レスポンスするデータを絞り込んで返信する。
- IoT機器でも使用できるように、小さなデータで通信を行う。

## 詳細
- クライアントのリクエストに対してサーバがレスポンスを返す、1:1のメッセージ交換形式で情報を取得する


## 情報の取得について
- 気象情報は定時更新のXMLから取得する。(https://www.data.jma.go.jp/developer/xml/feed/regular.xml)

- 災害情報は随時更新のXMLから取得する。
    - 随時更新の気象注意報・警報 (https://www.data.jma.go.jp/developer/xml/feed/extra.xml)
    - 随時更新の災害情報 (https://www.data.jma.go.jp/developer/xml/feed/eqvol.xml)



## リクエスト/レスポンスデータについて
以下の項目をパケットに含める

- 指定する地域 ( 16進数2バイトで指定 : 0x0000)
    - 指定されていなかったら送信元に最も近い気象台の情報を返す

- フラグ ( 0 取得しない / 1 取得する)
    - 天気の有無
    - 気温の有無
    - 降水確率の有無
    - 気象注意報・警報の有無
    - 災害情報の有無


## プロトコル詳細
- NTPベースのアプリケーションプロトコル
- MAC, IP, UDPの既存プロトコルを使用

- アプリケーションデータがリクエスト、レスポンスともに48バイト程度

### プロトコルフォーマット
- Version 4ビット
    - 0001 ( バージョン1 )
- Type 1ビット
    - 0 リクエスト / 1 レスポンス
- 地域ID 16ビット
    - 0x0000 ( 地域ごとにコードを割り当てる )
- タイムスタンプ 64ビット
    - 0000000000 ( UNIX時間形式)
- 天気コード
    - 1 晴れ
- 気温
    - 
- 降水確率
- 災害情報